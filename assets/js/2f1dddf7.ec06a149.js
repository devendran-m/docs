"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[7065],{3905:function(e,a,t){t.d(a,{Zo:function(){return l},kt:function(){return f}});var n=t(7294);function c(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function s(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);a&&(n=n.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),t.push.apply(t,n)}return t}function o(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{};a%2?s(Object(t),!0).forEach((function(a){c(e,a,t[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):s(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))}))}return e}function d(e,a){if(null==e)return{};var t,n,c=function(e,a){if(null==e)return{};var t,n,c={},s=Object.keys(e);for(n=0;n<s.length;n++)t=s[n],a.indexOf(t)>=0||(c[t]=e[t]);return c}(e,a);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(n=0;n<s.length;n++)t=s[n],a.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(c[t]=e[t])}return c}var r=n.createContext({}),i=function(e){var a=n.useContext(r),t=a;return e&&(t="function"==typeof e?e(a):o(o({},a),e)),t},l=function(e){var a=i(e.components);return n.createElement(r.Provider,{value:a},e.children)},h={inlineCode:"code",wrapper:function(e){var a=e.children;return n.createElement(n.Fragment,{},a)}},u=n.forwardRef((function(e,a){var t=e.components,c=e.mdxType,s=e.originalType,r=e.parentName,l=d(e,["components","mdxType","originalType","parentName"]),u=i(t),f=c,p=u["".concat(r,".").concat(f)]||u[f]||h[f]||s;return t?n.createElement(p,o(o({ref:a},l),{},{components:t})):n.createElement(p,o({ref:a},l))}));function f(e,a){var t=arguments,c=a&&a.mdxType;if("string"==typeof e||c){var s=t.length,o=new Array(s);o[0]=u;var d={};for(var r in a)hasOwnProperty.call(a,r)&&(d[r]=a[r]);d.originalType=e,d.mdxType="string"==typeof e?e:c,o[1]=d;for(var i=2;i<s;i++)o[i]=t[i];return n.createElement.apply(null,o)}return n.createElement.apply(null,t)}u.displayName="MDXCreateElement"},2623:function(e,a,t){t.r(a),t.d(a,{assets:function(){return l},contentTitle:function(){return r},default:function(){return f},frontMatter:function(){return d},metadata:function(){return i},toc:function(){return h}});var n=t(3117),c=t(102),s=(t(7294),t(3905)),o=["components"],d={},r="Setting up a Multi-sig Account",i={unversionedId:"dapp-dev-guide/tutorials/multi-sig/example",id:"dapp-dev-guide/tutorials/multi-sig/example",title:"Setting up a Multi-sig Account",description:"In this section, we will explore the commands to setup an account with associated keys and restrict access for deployment and key management to specific keys within the account.",source:"@site/source/docs/casper/dapp-dev-guide/tutorials/multi-sig/example.md",sourceDirName:"dapp-dev-guide/tutorials/multi-sig",slug:"/dapp-dev-guide/tutorials/multi-sig/example",permalink:"/dapp-dev-guide/tutorials/multi-sig/example",editUrl:"https://github.com/casper-network/docs/tree/main/source/docs/casper/dapp-dev-guide/tutorials/multi-sig/example.md",tags:[],version:"current",frontMatter:{},sidebar:"dapp-dev-guide",previous:{title:"Client Example",permalink:"/dapp-dev-guide/tutorials/multi-sig/client"},next:{title:"Additional Scenarios",permalink:"/dapp-dev-guide/tutorials/multi-sig/additional"}},l={},h=[{value:"Creating Accounts",id:"creating-accounts",level:2},{value:"Deploying the Keys Manager Contract",id:"deploying-the-keys-manager-contract",level:2},{value:"Check deploy status",id:"check-deploy-status",level:3},{value:"View account details",id:"view-account-details",level:3},{value:"Find session hash",id:"find-session-hash",level:3},{value:"Setting the Manager&#39;s Key Weight to 4",id:"setting-the-managers-key-weight-to-4",level:2},{value:"Viewing the Account Structure with an Associated Account",id:"viewing-the-account-structure-with-an-associated-account",level:3},{value:"Linking the Other Accounts and Setting Key Weights",id:"linking-the-other-accounts-and-setting-key-weights",level:2},{value:"Viewing Account Structure with All Associated Keys",id:"viewing-account-structure-with-all-associated-keys",level:3},{value:"Setting Key Management Threshold to 4",id:"setting-key-management-threshold-to-4",level:2},{value:"Setting Deploy Threshold to 3",id:"setting-deploy-threshold-to-3",level:2},{value:"Viewing Final Account Structure",id:"viewing-final-account-structure",level:2},{value:"Key Management Restrictions",id:"key-management-restrictions",level:2}],u={toc:h};function f(e){var a=e.components,t=(0,c.Z)(e,o);return(0,s.kt)("wrapper",(0,n.Z)({},u,t,{components:a,mdxType:"MDXLayout"}),(0,s.kt)("h1",{id:"setting-up-a-multi-sig-account"},"Setting up a Multi-sig Account"),(0,s.kt)("p",null,"In this section, we will explore the commands to setup an account with associated keys and restrict access for deployment and key management to specific keys within the account."),(0,s.kt)("p",null,"In this example, we will set up an account with the following weights and thresholds:"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"Three associated keys (Manager, Supervisor, and Clerk)"),(0,s.kt)("li",{parentName:"ul"},"Weights of the associated keys:",(0,s.kt)("ul",{parentName:"li"},(0,s.kt)("li",{parentName:"ul"},"Manager - 4"),(0,s.kt)("li",{parentName:"ul"},"Supervisor - 2"),(0,s.kt)("li",{parentName:"ul"},"Clerk - 1"))),(0,s.kt)("li",{parentName:"ul"},"Weights of the thresholds:",(0,s.kt)("ul",{parentName:"li"},(0,s.kt)("li",{parentName:"ul"},"Key management - 4"),(0,s.kt)("li",{parentName:"ul"},"Deploy - 3")))),(0,s.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,s.kt)("div",{parentName:"div",className:"admonition-heading"},(0,s.kt)("h5",{parentName:"div"},(0,s.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,s.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,s.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,s.kt)("div",{parentName:"div",className:"admonition-content"},(0,s.kt)("p",{parentName:"div"},"For all the commands used in this tutorial, here are a few pointers:"),(0,s.kt)("ul",{parentName:"div"},(0,s.kt)("li",{parentName:"ul"},"The ",(0,s.kt)("inlineCode",{parentName:"li"},"node-address")," attribute is a combination of a peer node IP address from the Mainnet or Testnet prefixed with ",(0,s.kt)("inlineCode",{parentName:"li"},"7777"),", which is the RPC port."),(0,s.kt)("li",{parentName:"ul"},"The ",(0,s.kt)("inlineCode",{parentName:"li"},"chain-name")," attribute, is ",(0,s.kt)("inlineCode",{parentName:"li"},"casper-test")," for Testnet and ",(0,s.kt)("inlineCode",{parentName:"li"},"casper")," for Mainnet."),(0,s.kt)("li",{parentName:"ul"},"The ",(0,s.kt)("inlineCode",{parentName:"li"},"amount")," attribute is the cost of the transaction in motes."),(0,s.kt)("li",{parentName:"ul"},"Hexadecimal public key is found in the ",(0,s.kt)("inlineCode",{parentName:"li"},"public_key_hex")," file. Copy the contents of this file and paste it in the command that calls for it.")))),(0,s.kt)("h2",{id:"creating-accounts"},"Creating Accounts"),(0,s.kt)("p",null,"Create three sets of keys one each for the Manager, Supervisor and Clerk."),(0,s.kt)("p",null,"To create accounts on the Casper blockchain, you need to generate keys and fund your accounts. For more information see ",(0,s.kt)("a",{parentName:"p",href:"/dapp-dev-guide/keys"},"Account and Cryptographic Keys"),"."),(0,s.kt)("p",null,"To fund your Testnet account, see ",(0,s.kt)("a",{parentName:"p",href:"/workflow/testnet-faucet"},"Funding Testnet Accounts"),"."),(0,s.kt)("h2",{id:"deploying-the-keys-manager-contract"},"Deploying the Keys Manager Contract"),(0,s.kt)("p",null,"Before you deploy the keys manager contract, you must clone the keys-manager repository and build the ",(0,s.kt)("a",{parentName:"p",href:"/dapp-dev-guide/tutorials/multi-sig/contract"},"contract"),"."),(0,s.kt)("p",null,"You can deploy the keys manager contract using the ",(0,s.kt)("inlineCode",{parentName:"p"},"put-deploy")," command as illustrated below."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"casper-client put-deploy \\\n--chain-name casper-test \\\n--node-address http://[NODE_IP_ADDRESS]:7777 \\\n--secret-key <path to secret_key.pem> \\\n--session-path <path to keys-manager.wasm> \\\n--payment-amount 10000000000\n")),(0,s.kt)("details",null,(0,s.kt)("summary",null,"Sample output with deploy hash"),(0,s.kt)("p",null,'{ "id": -4915929071409710835, "jsonrpc": "2.0", "result": { "api_version": "1.4.4", "deploy_hash": "3d55c71ae0892c9f5b63be56c8ca3e107e39e812ebc925383881cfa003aaced7" } }')),(0,s.kt)("h3",{id:"check-deploy-status"},"Check deploy status"),(0,s.kt)("p",null,"The deploy hash from the previous output is used to find the deploy status. The deploy usually takes a few minutes to execute, so please be patient."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"casper-client get-deploy <deploy hash> \\\n--node-address http://[NODE_IP_ADDRESS]:7777\n")),(0,s.kt)("details",null,(0,s.kt)("summary",null,"Sample output showing deploy status"),(0,s.kt)("p",null,'{ "id": -470146583313425542, "jsonrpc": "2.0", "result": { "api_version": "1.4.4", "deploy": { "approvals": ','[ { "signature": "015fa28d6a68000a05c323cf9933c3a93f1b0126a8c769048342b2059cab51b00232e6454abd31dfc2405887e8b4 8c38e38412a04290311883ba9f8f51bde5b0c", "signer": "01b00d1991357e1db95a52101ad7050d552c75a54ac6724c11756f514a181d520a" } ]',', "hash": "3d55c71ae0892c9f5b63be56c8ca3e107e39e812ebc925383881cfa003aaced7", "header": { "account": "01b00d1991357e1db95a52101ad7050d552c75a54ac6724c11756f514a181d520a", "body_hash": "21ae03fecc7491959bba4d290e2fc494163b5f29dd044143514d568eab7e9cab", "chain_name": "casper-test", "dependencies": [], "gas_price": 1, "timestamp": "2022-02-18T11:26:12.240Z", "ttl": "30m" }, "payment": { "ModuleBytes": { "args": [ ','[ "amount", { "bytes": "0500e8764817", "cl_type": "U512", "parsed": "100000000000" } ]',' ], "module_bytes": "" } }, "session": { "ModuleBytes": { "args": [], "module_bytes": "',"[381268 hex chars]",'" } } }, "execution_results": [ { "block_hash": "ed652d9cc06e5cd24429c67eb977e17e710fd57863c883c08efcdb88f0749607", "result": { "Success": { "cost": "74678904670", "effect": { "operations": [], "transforms": [ { "key": "hash-8cf5e4acf51f54eb59291599187838dc3bc234089c46fc6ca8ad17e762ae4401", "transform": "Identity" }, { "key": "hash-624dbe2395b9d9503fbee82162f1714ebff6b639f96d2084d26d944c354ec4c5", "transform": "Identity" }, { "key": "hash-010c3fe81b7b862e50c77ef9a958a05bfa98444f26f96f23d37a13c96244cfb7", "transform": "Identity" }, { "key": "hash-9824d60dc3a5c44a20b9fd260a412437933835b52fc683d8ae36e4ec2114843e", "transform": "Identity" }, { "key": "balance-250554daef44c5274f726f2556b62da7dbd6d997d6a93dea925104529db12e6a", "transform": "Identity" }, { "key": "balance-98d945f5324f865243b7c02c0417ab6eac361c5c56602fd42ced834a1ba201b6", "transform": "Identity" }, { "key": "balance-250554daef44c5274f726f2556b62da7dbd6d997d6a93dea925104529db12e6a", "transform": { "WriteCLValue": { "bytes": "0500282e8cd1", "cl_type": "U512", "parsed": "900000000000" } } }, { "key": "balance-98d945f5324f865243b7c02c0417ab6eac361c5c56602fd42ced834a1ba201b6", "transform": { "AddUInt512": "100000000000" } }, { "key": "uref-39e68561186ebe397246cc3e8da6b09edfa33ff8b114ca7f66b65a62b73f40df-000", "transform": { "WriteCLValue": { "bytes": "", "cl_type": "Unit", "parsed": null } } }, { "key": "hash-1096cb5a529e1eebeb3522cb5e3e7b60f3dd47de68b70ccc8a83560cd3a216db", "transform": "WriteContractPackage" }, { "key": "hash-1096cb5a529e1eebeb3522cb5e3e7b60f3dd47de68b70ccc8a83560cd3a216db", "transform": "Identity" }, { "key": "hash-0d90baf0b1e6b7a8bd45d172896a6d24616b457f1e1ee28081d821a00ffe62b3", "transform": "WriteContractWasm" }, { "key": "hash-fc8eaf47329d45c76c4f80ec4e6fdb08e74dbe4ae0391447c5ebd15f1c962476", "transform": "WriteContract" }, { "key": "hash-1096cb5a529e1eebeb3522cb5e3e7b60f3dd47de68b70ccc8a83560cd3a216db", "transform": "WriteContractPackage" }, { "key": "account-hash-694c109a08282d039ace20fbad7a692f4d800a7fd6db08848bc95f8a9f7e4273", "transform": { "AddKeys": ','[ { "key": "hash-fc8eaf47329d45c76c4f80ec4e6fdb08e74dbe4ae0391447c5ebd15f1c962476", "name": "keys_manager" } ]',' } }, { "key": "uref-3141039f23ae092028da3b8222ebb5ae5d8409e745b507903e5f7600fa42aada-000", "transform": { "WriteCLValue": { "bytes": "fc8eaf47329d45c76c4f80ec4e6fdb08e74dbe4ae0391447c5ebd15f1c962476", "cl_type": { "ByteArray": 32 }, "parsed": "fc8eaf47329d45c76c4f80ec4e6fdb08e74dbe4ae0391447c5ebd15f1c962476" } } }, { "key": "account-hash-694c109a08282d039ace20fbad7a692f4d800a7fd6db08848bc95f8a9f7e4273", "transform": { "AddKeys": ','[ { "key": "uref-3141039f23ae092028da3b8222ebb5ae5d8409e745b507903e5f7600fa42aada-007", "name": "keys_manager_hash" } ]',' } }, { "key": "deploy-3d55c71ae0892c9f5b63be56c8ca3e107e39e812ebc925383881cfa003aaced7", "transform": { "WriteDeployInfo": { "deploy_hash": "3d55c71ae0892c9f5b63be56c8ca3e107e39e812ebc925383881cfa003aaced7", "from": "account-hash-694c109a08282d039ace20fbad7a692f4d800a7fd6db08848bc95f8a9f7e4273", "gas": "74678904670", "source": "uref-250554daef44c5274f726f2556b62da7dbd6d997d6a93dea925104529db12e6a-007", "transfers": [] } } }, { "key": "balance-98d945f5324f865243b7c02c0417ab6eac361c5c56602fd42ced834a1ba201b6", "transform": "Identity" }, { "key": "hash-8cf5e4acf51f54eb59291599187838dc3bc234089c46fc6ca8ad17e762ae4401", "transform": "Identity" }, { "key": "hash-010c3fe81b7b862e50c77ef9a958a05bfa98444f26f96f23d37a13c96244cfb7", "transform": "Identity" }, { "key": "hash-9824d60dc3a5c44a20b9fd260a412437933835b52fc683d8ae36e4ec2114843e", "transform": "Identity" }, { "key": "balance-98d945f5324f865243b7c02c0417ab6eac361c5c56602fd42ced834a1ba201b6", "transform": "Identity" }, { "key": "balance-34b99d631b7545a56af663801f8b86c0f38cc014b002e9f7e0c0b2a19e789f14", "transform": "Identity" }, { "key": "balance-98d945f5324f865243b7c02c0417ab6eac361c5c56602fd42ced834a1ba201b6", "transform": { "WriteCLValue": { "bytes": "00", "cl_type": "U512", "parsed": "0" } } }, { "key": "balance-34b99d631b7545a56af663801f8b86c0f38cc014b002e9f7e0c0b2a19e789f14", "transform": { "AddUInt512": "100000000000" } } ] }, "transfers": [] } } } ] } }')),(0,s.kt)("h3",{id:"view-account-details"},"View account details"),(0,s.kt)("p",null,"The following command gets the account details after the deploy is successful:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre"},"casper-client get-account-info \\\n--public-key <hexadecimal public key> \\\n--node-address http://[NODE_IP_ADDRESS]:7777\n")),(0,s.kt)("p",null,"In the output of this command, you can see the key weight, key management threshold, and deploy threshold. Also, observe the main purse structure, which has the ",(0,s.kt)("inlineCode",{parentName:"p"},"keys_manager_hash")," uref address. In the next steps, this uref address is used to find the smart contract's ",(0,s.kt)("a",{parentName:"p",href:"#find-session-hash"},"session hash"),"."),(0,s.kt)("details",null,(0,s.kt)("summary",null,"Sample output with named keys for the keys manager contract"),(0,s.kt)("p",null,'{ "id": 3805776763924596530, "jsonrpc": "2.0", "result": { "account": { "account_hash": "account-hash-694c000a8282d039ace20fbad7a692f4d800a7fd6db08848bc95f8a9f7e4273", "action_thresholds": { "deployment": 1, "key_management": 1 }, "associated_keys": ','[ { "account_hash": "account-hash-694c000a08282d039ace20fbad7a692f4d800a7fd6db08848bc95f8a9f7e4273", "weight": 1 } ]',', "main_purse": "uref-250554daef44c5274f726f2556b62da7dbd6d997d6a93dea925104529db12e6a-007", "named_keys": ','[ { "key": "hash-fc8eaf47329d45c76c4f80ec4e6fdb08e74dbe4ae0391447c5ebd15f1c962476", "name": "keys_manager" }, { "key": "uref-3141039f23ae092028da3b8222ebb5ae5d8409e745b507903e5f7600fa42aada-007", "name": "keys_manager_hash" } ]',' }, "api_version": "1.4.4", "merkle_proof": "',"[26588 hex chars]",'" } }')),(0,s.kt)("p",null,"In the above output, you can see the named keys for the contract and the uref for ",(0,s.kt)("inlineCode",{parentName:"p"},"keys_manager_hash"),". This uref hash will be used to find the session hash of the contract."),(0,s.kt)("h3",{id:"find-session-hash"},"Find session hash"),(0,s.kt)("p",null,"To find the session hash, we need the state root hash and the uref hash of the keys manager contract."),(0,s.kt)("p",null,(0,s.kt)("strong",{parentName:"p"},"State root hash")),(0,s.kt)("p",null,"Use the following command to find the state root hash:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"casper-client get-state-root-hash --node-address http://[NODE_IP_ADDRESS]:7777\n")),(0,s.kt)("details",null,(0,s.kt)("summary",null,"Sample output with state root hash"),(0,s.kt)("p",null,'{ "id": -1255673544684673900, "jsonrpc": "2.0", "result": { "api_version": "1.4.4", "state_root_hash": "61743f2d702a36bae49faa57f221caf10725e0bff5481c2ec568ea4f0a28f69b" } }'),(0,s.kt)("p",null,"You can use this state root hash in the next section to find the session hash of the smart contract.")),(0,s.kt)("p",null,(0,s.kt)("strong",{parentName:"p"},"Uref hash of the keys manager contract")),(0,s.kt)("p",null,"You can find the uref hash in the account information of the account used to deploy the keys manager contract, see ",(0,s.kt)("a",{parentName:"p",href:"#view-account-details-view-account-details"},"View Account Details"),"."),(0,s.kt)("p",null,(0,s.kt)("strong",{parentName:"p"},"Session hash for keys manager contract")),(0,s.kt)("p",null,"Use the following command to get the session hash of the smart contract:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"casper-client query-state \\\n--node-address http://[NODE_IP_ADDRESS]:7777 \\\n--key <uref of keys_manager_hash> \\\n--state-root-hash <network state root hash>\n")),(0,s.kt)("p",null,"In the following output, the parsed value is the session hash ",(0,s.kt)("inlineCode",{parentName:"p"},"fc8eaf47329d45c76c4f80ec4e6fdb08e74dbe4ae0391447c5ebd15f1c962476"),"."),(0,s.kt)("details",null,(0,s.kt)("summary",null,"Sample output with session hash"),(0,s.kt)("p",null,'{ "id": -3744898570362638107, "jsonrpc": "2.0", "result": { "api_version": "1.4.4", "block_header": null, "merkle_proof": "',"[34692 hex chars]",'", "stored_value": { "CLValue": { "bytes": "fc8eaf47329d45c76c4f80ec4e6fdb08e74dbe4ae0391447c5ebd15f1c962476", "cl_type": { "ByteArray": 32 }, "parsed": "fc8eaf47329d45c76c4f80ec4e6fdb08e74dbe4ae0391447c5ebd15f1c962476" } } } }')),(0,s.kt)("h2",{id:"setting-the-managers-key-weight-to-4"},"Setting the Manager's Key Weight to 4"),(0,s.kt)("p",null,"Let's setup the main account (Manager) with a key weight of 4."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"casper-client put-deploy \\\n--chain-name casper-test \\\n--node-address http://[NODE_IP_ADDRESS]:7777 \\\n--secret-key <local path of secret_key.pem file> \\\n--session-hash <session hash of keys manager contract>\\\n--payment-amount 1000000000 \\\n--session-entry-point set_key_weight \\\n--session-arg \"account:public_key='01b2200091357e1db95a52101ad7050d552c75a54ac6724c11756f514a181d520a'\" \\\n--session-arg \"weight:u8='4'\"\n")),(0,s.kt)("p",null,"In the above command, observe the following:"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"The ",(0,s.kt)("inlineCode",{parentName:"li"},"secret-key")," attribute should point to the ",(0,s.kt)("inlineCode",{parentName:"li"},"secret_key.pem")," file"),(0,s.kt)("li",{parentName:"ul"},"The ",(0,s.kt)("inlineCode",{parentName:"li"},"session-entry-point")," attribute value is ",(0,s.kt)("inlineCode",{parentName:"li"},"set_key_weight"),", which remains the same for setting keys weights for all the keys."),(0,s.kt)("li",{parentName:"ul"},"The ",(0,s.kt)("inlineCode",{parentName:"li"},"session-arg")," for ",(0,s.kt)("inlineCode",{parentName:"li"},"set_key_weight")," are the hexadecimal public key of the key pair that you want to set the weight for and the new weight for the key. In this example, the hex public key is of the Manager's account.")),(0,s.kt)("details",null,(0,s.kt)("summary",null,"Sample output with deploy hash"),(0,s.kt)("p",null,'{ "id": -8205577127765151372, "jsonrpc": "2.0", "result": { "api_version": "1.4.4", "deploy_hash": "70f8f95afdcf5729b58a5000f1b566448305890c99c21ded1a2bdc70773fdbc1" } }')),(0,s.kt)("p",null,"You can use the deploy hash from the above output to find the deploy status."),(0,s.kt)("h3",{id:"viewing-the-account-structure-with-an-associated-account"},"Viewing the Account Structure with an Associated Account"),(0,s.kt)("p",null,"You view the updated account structure using the following command:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"casper-client get-account-info \\\n--public-key <hex public key of Manager account> \\\n--node-address http://[NODE_IP_ADDRESS]:7777\n")),(0,s.kt)("details",null,(0,s.kt)("summary",null,"Sample output with one associated key"),(0,s.kt)("p",null,'{ "id": -244324861334765287, "jsonrpc": "2.0", "result": { "account": { "account_hash": "account-hash-694c109a08282d039ace20fbad7a692f4d800a7fd6db08848bc95f8a9f7e4273", "action_thresholds": { "deployment": 1, "key_management": 1 }, "associated_keys": ','[ { "account_hash": "account-hash-694c109a08282d039ace20fbad7a692f4d800a7fd6db08848bc95f8a9f7e4273", "weight": 4 }, { "account_hash": "account-hash-f19e3269ae27a44d5debfcd2df0a5b5dd6c31961d335a09dcd5f782ddebb3683", "weight": 2 } ]',', "main_purse": "uref-250554daef44c5274f726f2556b62da7dbd6d997d6a93dea925104529db12e6a-007", "named_keys": ','[ { "key": "hash-fc8eaf47329d45c76c4f80ec4e6fdb08e74dbe4ae0391447c5ebd15f1c962476", "name": "keys_manager" }, { "key": "uref-3141039f23ae092028da3b8222ebb5ae5d8409e745b507903e5f7600fa42aada-007", "name": "keys_manager_hash" } ]',' }, "api_version": "1.4.4", "merkle_proof": "',"[26654 hex chars]",'" } }')),(0,s.kt)("h2",{id:"linking-the-other-accounts-and-setting-key-weights"},"Linking the Other Accounts and Setting Key Weights"),(0,s.kt)("p",null,"You can link an account and set the key weight for that account in one command. To do this, use the secret_key.pem file of the main account and the hexadecimal primary key of the account to link. An example of how the ",(0,s.kt)("inlineCode",{parentName:"p"},"put-deploy")," command is used to link accounts and set weights, is shown here:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"casper-client put-deploy \\\n--chain-name casper-test \\\n--node-address http://[NODE_IP_ADDRESS]:7777 \\\n--secret-key <path to Manager secret_key.pem> \\\n--session-hash <session hash of keys manager contract> \\\n--payment-amount 1000000000 \\\n--session-entry-point set_key_weight \\\n--session-arg \"account:public_key='01e6c6000a88f122d463ed083e81f77da2c58cb92529eb422274641e4b3b2126a'\" \\\n--session-arg \"weight:u8='2'\"\n")),(0,s.kt)("p",null,"In the above command, observe the following:"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"The ",(0,s.kt)("inlineCode",{parentName:"li"},"secret-key")," should point to the ",(0,s.kt)("inlineCode",{parentName:"li"},"secret_key.pem")," file of the main account (Manager). The amount for the transaction will be deducted from the main purse of this account."),(0,s.kt)("li",{parentName:"ul"},"The hexadecimal public key should be of the account you wish to associate with the main account. In this case, it is the Supervisor's account.")),(0,s.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,s.kt)("div",{parentName:"div",className:"admonition-heading"},(0,s.kt)("h5",{parentName:"div"},(0,s.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,s.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,s.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,s.kt)("div",{parentName:"div",className:"admonition-content"},(0,s.kt)("p",{parentName:"div"},"You can use this command to set the weight for the Clerk's account as well. To do so, replace the hexadecimal public key with that of the Clerk's account and keep the weight as 1."))),(0,s.kt)("h3",{id:"viewing-account-structure-with-all-associated-keys"},"Viewing Account Structure with All Associated Keys"),(0,s.kt)("p",null,"You can view the updated account structure using the following command:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"casper-client get-account-info \\\n--public-key <hex public key of Manager account> \\\n--node-address http://[NODE_IP_ADDRESS]:7777\n")),(0,s.kt)("details",null,(0,s.kt)("summary",null,"Sample output showing the account structure with all associated keys"),(0,s.kt)("p",null,'{ "id": 2242895416442018609, "jsonrpc": "2.0", "result": { "account": { "account_hash": "account-hash-694c109a08282d039ace20fbad7a692f4d800a7fd6db08848bc95f8a9f7e4273", "action_thresholds": { "deployment": 1, "key_management": 1 }, "associated_keys": ','[ { "account_hash": "account-hash-694c109a08282d039ace20fbad7a692f4d800a7fd6db08848bc95f8a9f7e4273", "weight": 4 }, { "account_hash": "account-hash-b3ff5309f983f2b30c70fc5fdf36eecab8460759e3465cccb1f7718704ebba27", "weight": 1 }, { "account_hash": "account-hash-f19e3269ae27a44d5debfcd2df0a5b5dd6c31961d335a09dcd5f782ddebb3683", "weight": 2 } ]',', "main_purse": "uref-250554daef44c5274f726f2556b62da7dbd6d997d6a93dea925104529db12e6a-007", "named_keys": ','[ { "key": "hash-fc8eaf47329d45c76c4f80ec4e6fdb08e74dbe4ae0391447c5ebd15f1c962476", "name": "keys_manager" }, { "key": "uref-3141039f23ae092028da3b8222ebb5ae5d8409e745b507903e5f7600fa42aada-007", "name": "keys_manager_hash" } ]',' }, "api_version": "1.4.4", "merkle_proof": "',"[26720 hex chars]",'" } }')),(0,s.kt)("h2",{id:"setting-key-management-threshold-to-4"},"Setting Key Management Threshold to 4"),(0,s.kt)("p",null,"To set the key management threshold we will use the ",(0,s.kt)("inlineCode",{parentName:"p"},"set_key_management_threshold")," entry point. Also, keep in mind these ",(0,s.kt)("a",{parentName:"p",href:"#key-management-restrictions"},"restrictions")," while setting the thresholds for account management. You can use the following command to set the key management threshold:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"casper-client put-deploy \\\n--chain-name casper-test \\\n--node-address http://[NODE_IP_ADDRESS]:7777 \\\n--secret-key <path to Manager secret_key.pem> \\\n--session-hash <session hash of keys manager contract> \\\n--payment-amount 5000000000 \\\n--session-entry-point set_key_management_threshold \\\n--session-arg \"weight:u8='4'\"\n")),(0,s.kt)("p",null,"Use the following command to see the updated account structure:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"casper-client get-account-info \\\n--public-key <hex public key of Manager account> \\\n--node-address http://[NODE_IP_ADDRESS]:7777\n")),(0,s.kt)("details",null,(0,s.kt)("summary",null,"Sample output with the updated key management threshold"),(0,s.kt)("p",null,'{ "id": 2760750489916445167, "jsonrpc": "2.0", "result": { "account": { "account_hash": "account-hash-694c109a08282d039ace20fbad7a692f4d800a7fd6db08848bc95f8a9f7e4273", "action_thresholds": { "deployment": 1, "key_management": 4 }, "associated_keys": ','[ { "account_hash": "account-hash-694c109a08282d039ace20fbad7a692f4d800a7fd6db08848bc95f8a9f7e4273", "weight": 4 }, { "account_hash": "account-hash-b3ff5309f983f2b30c70fc5fdf36eecab8460759e3465cccb1f7718704ebba27", "weight": 1 }, { "account_hash": "account-hash-f19e3269ae27a44d5debfcd2df0a5b5dd6c31961d335a09dcd5f782ddebb3683", "weight": 2 } ]',', "main_purse": "uref-250554daef44c5274f726f2556b62da7dbd6d997d6a93dea925104529db12e6a-007", "named_keys": ','[ { "key": "hash-fc8eaf47329d45c76c4f80ec4e6fdb08e74dbe4ae0391447c5ebd15f1c962476", "name": "keys_manager" }, { "key": "uref-3141039f23ae092028da3b8222ebb5ae5d8409e745b507903e5f7600fa42aada-007", "name": "keys_manager_hash" } ]',' }, "api_version": "1.4.4", "merkle_proof": "',"[26720 hex chars]",'" } }')),(0,s.kt)("h2",{id:"setting-deploy-threshold-to-3"},"Setting Deploy Threshold to 3"),(0,s.kt)("p",null,"You can use the following command to set the deploy threshold to 3."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"casper-client put-deploy \\\n--chain-name casper-test \\\n--node-address http://[NODE_IP_ADDRESS]:7777 \\\n--secret-key <path to Manager secret_key.pem> \\\n--session-hash <session hash of keys manager contract> \\\n--payment-amount 5000000000 \\\n--session-entry-point set_deployment_threshold \\\n--session-arg \"weight:u8='3'\"\n")),(0,s.kt)("h2",{id:"viewing-final-account-structure"},"Viewing Final Account Structure"),(0,s.kt)("p",null,"Once again we will use the ",(0,s.kt)("inlineCode",{parentName:"p"},"get-account-info")," command to view the main account structure."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-bash"},"casper-client get-account-info \\\n--public-key <hex public key of Manager account> \\\n--node-address http://[NODE_IP_ADDRESS]:7777\n")),(0,s.kt)("p",null,"The following account structure will be visible after all the key weights and thresholds are set."),(0,s.kt)("details",null,(0,s.kt)("summary",null,"Sample final account structure"),(0,s.kt)("p",null,'{ "id": -1053187261000032037, "jsonrpc": "2.0", "result": { "account": { "account_hash": "account-hash-694c109a08282d039ace20fbad7a692f4d800a7fd6db08848bc95f8a9f7e4273", "action_thresholds": { "deployment": 3, "key_management": 4 }, "associated_keys": ','[ { "account_hash": "account-hash-694c109a08282d039ace20fbad7a692f4d800a7fd6db08848bc95f8a9f7e4273", "weight": 4 }, { "account_hash": "account-hash-b3ff5309f983f2b30c70fc5fdf36eecab8460759e3465cccb1f7718704ebba27", "weight": 1 }, { "account_hash": "account-hash-f19e3269ae27a44d5debfcd2df0a5b5dd6c31961d335a09dcd5f782ddebb3683", "weight": 2 } ]',', "main_purse": "uref-250554daef44c5274f726f2556b62da7dbd6d997d6a93dea925104529db12e6a-007", "named_keys": ','[ { "key": "hash-fc8eaf47329d45c76c4f80ec4e6fdb08e74dbe4ae0391447c5ebd15f1c962476", "name": "keys_manager" }, { "key": "uref-3141039f23ae092028da3b8222ebb5ae5d8409e745b507903e5f7600fa42aada-007", "name": "keys_manager_hash" } ]',' }, "api_version": "1.4.4", "merkle_proof": "',"[26720 hex chars]",'" } }')),(0,s.kt)("h2",{id:"key-management-restrictions"},"Key Management Restrictions"),(0,s.kt)("p",null,"This section explains a few rules that apply to key management:"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"Set the deployment threshold lower than or equal to the key-management threshold"),(0,s.kt)("li",{parentName:"ul"},"Set the deployment threshold lower than or equal to all other thresholds"),(0,s.kt)("li",{parentName:"ul"},"Ensure the account used to set the thresholds has sufficient permissions"),(0,s.kt)("li",{parentName:"ul"},"Set the thresholds to a value lower than the total weight of associated keys")),(0,s.kt)("p",null,"We offer some additional examples of account management in the next section."),(0,s.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,s.kt)("div",{parentName:"div",className:"admonition-heading"},(0,s.kt)("h5",{parentName:"div"},(0,s.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,s.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,s.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,s.kt)("div",{parentName:"div",className:"admonition-content"},(0,s.kt)("p",{parentName:"div"},"To make a transfer using your multisig account, see ",(0,s.kt)("a",{parentName:"p",href:"/workflow/deploy-transfer"},"Transferring Tokens using a Multisig Account"),"."))))}f.isMDXComponent=!0}}]);