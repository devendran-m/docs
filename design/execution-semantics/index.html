<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.17">
<title data-rh="true">Execution Semantics | Casper</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://operators.casper.network//design/execution-semantics/"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Execution Semantics | Casper"><meta data-rh="true" name="description" content="execution-semantics-head}"><meta data-rh="true" property="og:description" content="execution-semantics-head}"><link data-rh="true" rel="icon" href="/image/favicon.ico"><link data-rh="true" rel="canonical" href="https://operators.casper.network//design/execution-semantics/"><link data-rh="true" rel="alternate" href="https://operators.casper.network//design/execution-semantics/" hreflang="en"><link data-rh="true" rel="alternate" href="https://operators.casper.network//design/execution-semantics/" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.601f6aec.css">
<link rel="preload" href="/assets/js/runtime~main.6cc55ec8.js" as="script">
<link rel="preload" href="/assets/js/main.31609aeb.js" as="script">
</head>
<body class="navigation-with-keyboard" data-theme="light">
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/icon/logo-dark.svg" alt="Casper Logo" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/icon/logo-white.svg" alt="Casper Logo" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title"></b></a><a class="navbar__item navbar__link" href="/workflow/">How To&#x27;s</a><a class="navbar__item navbar__link" href="/dapp-dev-guide/">Developers</a><a class="navbar__item navbar__link" href="/operators/">Operators</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/design/">Design</a><a class="navbar__item navbar__link" href="/economics/">Economics</a><a class="navbar__item navbar__link" href="/staking/">Staking</a><a class="navbar__item navbar__link" href="/glossary/">Glossary</a><a class="navbar__item navbar__link" href="/faq/">FAQ</a><a href="https://discord.gg/casperblockchain" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Chat<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__link"><span><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_dNtB"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg><span>English</span></span></a><ul class="dropdown__menu"><li><a href="/design/execution-semantics/" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active">English</a></li></ul></div><a href="https://github.com/casper-network/docs-app" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_S7eR toggle_TdHA toggleDisabled_f9M3"><div class="toggleButton_rCf9" role="button" tabindex="-1"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_v35p"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_nQuB"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></div><input type="checkbox" class="toggleScreenReader_g2nN" aria-label="Switch between dark and light mode (currently light mode)"></div><div class="dsla-search-wrapper"><div class="dsla-search-field" data-tags="default,docs-default-current"></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_P2Lg"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><aside class="theme-doc-sidebar-container docSidebarContainer_rKC_"><div class="sidebar_CW9Y"><nav class="menu thin-scrollbar menu_SkdO"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/design/">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/design/p2p/">Network Communication</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/design/global-state/">Global State</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/design/execution-semantics/">Execution Semantics</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/design/accounts/">Accounts</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/design/block-structure/">Block Structure</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/design/uref/">Unforgeable Reference (URef)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/design/serialization-standard/">Serialization Standard</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/design/tokens/">Tokens</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/design/checksummed-hex/">Checksum Hex Encoding</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/design/appendix/">Appendix</a></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_cwdi"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_xORG"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></aside><main class="docMainContainer_TCnq"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="docItemContainer_vinB"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Xlws" aria-label="breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a class="breadcrumbs__link breadcrumbsItemLink_e5ie" href="/">🏠</a></li><li class="breadcrumbs__item breadcrumbs__item--active"><a class="breadcrumbs__link breadcrumbsItemLink_e5ie" href="/design/execution-semantics/">Execution Semantics</a></li></ul></nav><div class="tocCollapsible_jdIR theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_Fzxq">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Execution Semantics</h1><h2 class="anchor anchorWithStickyNavbar_mojV" id="execution-semantics-intro">Introduction<a class="hash-link" href="#execution-semantics-intro" title="Direct link to heading">​</a></h2><p>The Casper Network is a decentralized computation platform. In this chapter we describe aspects of the computational model we use.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="execution-semantics-gas">Measuring computational work<a class="hash-link" href="#execution-semantics-gas" title="Direct link to heading">​</a></h2><p>Computation is all done in a <a href="https://webassembly.org/" target="_blank" rel="noopener noreferrer">WebAssembly (wasm)</a> interpreter, allowing any programming language which compiles to wasm to become a smart contract language for the Casper blockchain. Similar to Ethereum, we use <code>Gas</code> to measure computational work in a way which is consistent from node to node in the Casper Network. Each wasm instruction is <a href="https://github.com/casper-network/casper-node/blob/cb1d20ad1ea6e245cd8237f9406885a1e785c669/execution_engine/src/shared/wasm_config.rs#L15" target="_blank" rel="noopener noreferrer">assigned</a> a <code>Gas</code> value, and the amount of gas spent is tracked by the runtime with each instruction executed by the interpreter. All executions are finite because each has a finite <em>gas limit</em> that specifies the maximum amount of gas that can be spent before the computation is terminated by the runtime. How this limit is determined is discussed in more detail below.</p><p>Although computation is measured in <code>Gas</code>, we still take payment for computation in <a href="/design/tokens/#tokens-divisibility">motes</a>. Therefore, there is a conversion rate between <code>Gas</code> and motes. How this conversion rate is determined is discussed elsewhere.</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>Please note that Casper will not refund any amount of unused gas.</p><p>This decision is taken to incentivizing the <a href="/runtime/#runtime-economics">Casper Runtime Economics</a> by efficiently allocating the computational resources. The <a href="/runtime/#consensus-before-execution-basics-of-payment">consensus-before-execution model</a> implements the mechanism to encourage the optimized gas consumption from the user-side and to prevent the overuse of block space by poorly handled deploys.</p></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="execution-semantics-deploys">Deploys<a class="hash-link" href="#execution-semantics-deploys" title="Direct link to heading">​</a></h2><p>A <em>deploy</em> represents a request from a user to perform computation on our platform. It has the following information:</p><ul><li>Body: containing payment code and session code (more details on these below)</li><li>Header: containing<ul><li>the <a href="/design/global-state/#global-state-account-key">identity key</a> of the account the deploy will run in</li><li>the timestamp when the deploy was created</li><li>a time to live, after which the deploy is expired and cannot be included in a block</li><li>the <code>blake2b256</code> hash of the body</li></ul></li><li>Deploy hash: the <code>blake2b256</code> hash of the Header</li><li>Approvals: the set of signatures which have signed the deploy hash, these are used in the <a href="/design/accounts/#accounts-associated-keys-weights">account permissions model</a></li></ul><p>Each deploy is an atomic piece of computation in the sense that, whatever effects a deploy would have on the global state must be entirely included in a block or the entire deploy must not be included in a block.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="execution-semantics-phases">Deploy Lifecycle<a class="hash-link" href="#execution-semantics-phases" title="Direct link to heading">​</a></h3><p>A deploy goes through the following phases on Casper:</p><ol><li>Deploy Received</li><li>Deploy Gossiped</li><li>Block Proposed</li><li>Block Gossiped</li><li>Consensus Reached</li><li>Deploy Executed</li></ol><h3 class="anchor anchorWithStickyNavbar_mojV" id="deploy-received">Deploy Received<a class="hash-link" href="#deploy-received" title="Direct link to heading">​</a></h3><p>The client sending the deploy will send it to one or more nodes via their JSON RPC servers. The deploy acceptor, which is the component responsible for receiving the deploy from the JSON-RPC or another node, will run validity checks on the deploy and allow the lifecycle to continue or return an appropriate error. Once accepted, the deploy hash is returned to the client to indicate it has been enqueued for execution.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="deploy-gossiped">Deploy Gossiped<a class="hash-link" href="#deploy-gossiped" title="Direct link to heading">​</a></h3><p>After a node accepts a new deploy, it will gossip to all other nodes. A validator node will put the deploy into the block proposer buffer. The validator leader will pick the deploy from the block proposer buffer to create a new block for the chain. This mechanism is efficient and ensures all nodes in the network eventually hold the given deploy.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="block-proposed">Block Proposed<a class="hash-link" href="#block-proposed" title="Direct link to heading">​</a></h3><p>The validator leader for this round will propose a block that includes as many deploys from the block proposer buffer as can fit in a block.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="block-gossiped">Block Gossiped<a class="hash-link" href="#block-gossiped" title="Direct link to heading">​</a></h3><p>The proposed block is propagated to all other nodes.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="consensus-reached">Consensus Reached<a class="hash-link" href="#consensus-reached" title="Direct link to heading">​</a></h3><p>Once the other validators reach consensus that the proposed block is valid, all deploys in the block are executed, and this block becomes the final block added to the chain.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="deploy-executed">Deploy Executed<a class="hash-link" href="#deploy-executed" title="Direct link to heading">​</a></h3><p>A deploy is executed in distinct phases to accommodate flexibly paying for computation. The phases of a deploy are payment, session, and finalization. During the payment phase, the payment code is executed. If it is successful, the session code is executed during the session phase. And, independently of session code execution, the finalization phase does some bookkeeping around payment.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="execution-semantics-payment">Payment code<a class="hash-link" href="#execution-semantics-payment" title="Direct link to heading">​</a></h4><p><em>Payment code</em> provides the logic used to pay for the computation the deploy will do. Payment code is allowed to include arbitrary logic, providing maximal flexibility in how a deploy can be paid for (e.g., the simplest payment code could use the account&#x27;s <a href="/design/tokens/#tokens-purses-and-accounts">main purse</a>, while an enterprise application may require deploys to pay via a multi-sig application accessing a corporate purse). We restrict the gas limit of the payment code execution, based on the current conversion rate between gas and motes, such that no more than <code>MAX_PAYMENT_COST</code> motes (a constant of the system) are spent. To ensure payment code will pay for its own computation, we only allow accounts with a balance in their main purse greater than or equal to <code>MAX_PAYMENT_COST</code>, to execute deploys.</p><p>Payment code ultimately provides its payment by performing a <a href="/design/tokens/#tokens-mint-interface">token transfer</a> into the <a href="https://github.com/casper-network/casper-node/blob/cb1d20ad1ea6e245cd8237f9406885a1e785c669/types/src/system/handle_payment/mod.rs#L65" target="_blank" rel="noopener noreferrer">Handle Payment contract&#x27;s payment purse</a>. If payment is not given or not enough is transferred, then payment execution is not considered successful. In this case the effects of the payment code on the global state are reverted and the cost of the computation is covered by motes taken from the offending account&#x27;s main purse.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="execution-semantics-session">Session code<a class="hash-link" href="#execution-semantics-session" title="Direct link to heading">​</a></h4><p><em>Session code</em> provides the main logic for the deploy. It is only executed if the payment code is successful. The gas limit for this computation is determined based on the amount of payment given (after subtracting the cost of the payment code itself).</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="execution-semantics-specifying-code">Specifying payment code and session code<a class="hash-link" href="#execution-semantics-specifying-code" title="Direct link to heading">​</a></h4><p>The user-defined logic of a deploy can be specified in a number of ways:</p><ul><li>a wasm module in binary format representing a valid <a href="/design/serialization-standard/#global-state-contracts">contract</a> (Note: the named keys do not need to be specified because they come from the account the deploy is running in)</li><li>a 32-byte identifier representing the <a href="/design/serialization-standard/#serialization-standard-hash-key">hash</a> or <a href="/design/serialization-standard/#serialization-standard-uref">URef</a> where a contract is already stored in the global state</li><li>a name corresponding to a named key in the account, where a contract is stored under the key</li></ul><p>Each of payment and session code are independently specified, so different methods of specifying them may be used (e.g. payment could be specified by a hash key, while session is explicitly provided as a wasm module).</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="execution-semantics-deploys-as-functions">Deploys as functions on the global state<a class="hash-link" href="#execution-semantics-deploys-as-functions" title="Direct link to heading">​</a></h2><p>To enable concurrent modification of <a href="/design/global-state/#global-state-head">global state</a> (either by parallel deploys in the same block or parallel blocks on different forks of the chain), we view each deploy as a function taking our global state as input and producing a new global state as output. It is safe to execute two such functions concurrently if they do not interfere with each other, which formally can be defined to mean the functions <em>commute</em> (i.e., if they were executed sequentially, it does not matter in what order they are executed, the final result is the same for a given input). Whether two deploys commute is determined based on the effects they have on the global state, i.e. which operation (read, write, add) it does on each key in the key-value store. How this is done is described in <a href="/design/appendix/#appendix-c">Appendix C</a>.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="execution-semantics-runtime">The Casper Network runtime<a class="hash-link" href="#execution-semantics-runtime" title="Direct link to heading">​</a></h2><p>A wasm module is not natively able to create any effects outside of reading / writing from its own linear memory. To enable other effects (e.g. reading / writing to the Casper global state), wasm modules must import functions from the host environment they are running in. In the case of contracts on the Casper blockchain, this host is the Casper runtime.</p><p>Here, we briefly describe the functionalities provided by imported functions. All these features are conveniently accessible via functions in the <a href="https://crates.io/crates/casper-contract" target="_blank" rel="noopener noreferrer">Casper Rust library</a>. For a more detailed description of the functions available for contracts to import, see <a href="/design/appendix/#appendix-a">Appendix A</a>.</p><ul><li>Reading / writing from global state<ul><li><code>read</code>, <code>write</code>, <code>add</code> functions allow working with exiting <a href="/design/serialization-standard/#serialization-standard-uref">URefs</a></li><li><code>new_uref</code> allows creating a new <code>URef</code> initialized with a given value (see section below about how <code>URef</code>s are generated)</li><li><code>store_function</code> allows writing a contract under a <a href="/design/serialization-standard/#serialization-standard-hash-key">hash key</a></li><li><code>get_uref</code>, <code>list_known_urefs</code>, <code>add_uref</code>, <code>remove_uref</code> allow working with the <a href="/design/serialization-standard/#global-state-contracts">named keys</a> of the current context (account or contract)</li></ul></li><li>Account functionality<ul><li><code>add_associated_key</code>, <code>remove_associated_key</code>, <code>update_associated_key</code>, <code>set_action_threshold</code> support the various <a href="/design/accounts/#accounts-key-management">key management actions</a></li><li><code>main_purse</code> returns the <a href="/design/tokens/#tokens-purses-and-accounts">main purse</a> of the account</li></ul></li><li>Runtime flow and properties<ul><li><code>call_contract</code> allows executing a contract stored under a key (hash or <code>URef</code>), including passing arguments and getting a return value</li><li><code>ret</code> is used by contracts to return a value to their caller (i.e. enables return values from <code>call_contract</code>)</li><li><code>get_named_arg</code> allows getting arguments passed to the contract (either to session code as part of the deploy, or arguments to <code>call_contract</code>)</li><li><code>revert</code> exits the entire executing deploy, reverting any effects it caused, and returns a status code that is captured in the block</li><li><code>get_caller</code> returns the public key of the account for the current deploy (can be used for control flow based on specific users of the blockchain)</li><li><code>get_phase</code> returns the current <a href="#execution-semantics-phases">phase</a> of the deploy execution</li><li><code>get_blocktime</code> gets the timestamp of the block this deploy will be included in</li></ul></li><li><a href="/design/tokens/#tokens-mints-and-purses">Mint</a> functionality<ul><li><code>create_purse</code> creates a new empty purse, returning the <code>URef</code> to the purse</li><li><code>get_balance</code> reads the balance of a purse</li><li><code>transfer_to_account</code> transfers from the present account&#x27;s main purse to the main purse of a specified account (creating the account if it does not exist)</li><li><code>transfer_from_purse_to_account</code> transfer from a specified purse to the main purse of a specified account (creating the account if it does not exist)</li><li><code>transfer_from_purse_to_purse</code> alias for the <a href="/design/tokens/#tokens-mint-interface">mint’s transfer function</a></li></ul></li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="execution-semantics-urefs">Generating <code>URef</code>s<a class="hash-link" href="#execution-semantics-urefs" title="Direct link to heading">​</a></h3><p><code>URef</code>s are generated using a <a href="https://rust-random.github.io/rand/rand_chacha/struct.ChaCha20Rng.html" target="_blank" rel="noopener noreferrer">cryptographically secure random number generator</a> using the <a href="https://cr.yp.to/chacha.html" target="_blank" rel="noopener noreferrer">ChaCha algorithm</a>. The random number generator is seeded by taking the <code>blake2b256</code> hash of the deploy hash concatenated with an index representing the current phase of execution (to prevent collisions between <code>URef</code>s generated in different phases of the same deploy).</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/casper-network/docs/tree/main/source/docs/casper/design/execution-semantics.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_dcUD" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_foO9"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/design/global-state/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Global State</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/design/accounts/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Accounts</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#execution-semantics-intro" class="table-of-contents__link toc-highlight">Introduction</a></li><li><a href="#execution-semantics-gas" class="table-of-contents__link toc-highlight">Measuring computational work</a></li><li><a href="#execution-semantics-deploys" class="table-of-contents__link toc-highlight">Deploys</a><ul><li><a href="#execution-semantics-phases" class="table-of-contents__link toc-highlight">Deploy Lifecycle</a></li><li><a href="#deploy-received" class="table-of-contents__link toc-highlight">Deploy Received</a></li><li><a href="#deploy-gossiped" class="table-of-contents__link toc-highlight">Deploy Gossiped</a></li><li><a href="#block-proposed" class="table-of-contents__link toc-highlight">Block Proposed</a></li><li><a href="#block-gossiped" class="table-of-contents__link toc-highlight">Block Gossiped</a></li><li><a href="#consensus-reached" class="table-of-contents__link toc-highlight">Consensus Reached</a></li><li><a href="#deploy-executed" class="table-of-contents__link toc-highlight">Deploy Executed</a></li></ul></li><li><a href="#execution-semantics-deploys-as-functions" class="table-of-contents__link toc-highlight">Deploys as functions on the global state</a></li><li><a href="#execution-semantics-runtime" class="table-of-contents__link toc-highlight">The Casper Network runtime</a><ul><li><a href="#execution-semantics-urefs" class="table-of-contents__link toc-highlight">Generating <code>URef</code>s</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright"><div class="footer-inner-container">
    <div class="footer-top">
        <ul class="items">
            <li><a href="https://arxiv.org/pdf/2101.02159.pdf" target="_blank" rel="noopener">White Paper</a></li>
            <li>
                <a href="https://docs.casperlabs.io" target="_blank" rel="noopener"> Docs </a>
            </li>
            <li><a href="https://devxdao.com/" target="_blank" rel="noopener">Grant Program</a></li>
            <li><a href="https://casper.network/network/casper-association" target="_blank" rel="noopener">Casper Association</a></li>
        </ul>
    </div>
    <div class="footer-bottom">
        <ul class="items left">
            <li>
                <a href="https://casper.network/en/network" target="_blank" rel="noopener">
                    <img class="footer-logo" src="/icon/logo-white.svg" alt="Casper Logo">
                </a>
            </li>
            <li>© 2021 Casper Association</li>
        </ul>
        <ul class="items right">
            <li class="trademark">
                <a href="https://casper.network/network/trademark-policy" target="_blank" rel="noopener">Trademark Policy and Guidelines</a>
            </li>
        </ul>
    </div>
</div>
</div></div></div></footer></div>
<script src="/assets/js/runtime~main.6cc55ec8.js"></script>
<script src="/assets/js/main.31609aeb.js"></script>
</body>
</html>